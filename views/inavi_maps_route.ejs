<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, inital-scale=1.0">
    <title>ë‹¤ì¤‘ê²½ë¡œíƒìƒ‰</title>
</head>

<body>
    <link rel="stylesheet" href="css/maps_inavi.css" />

    <script type="text/javascript" src="script/inavimaps.js"></script>
    <script type="text/javascript" src="script/boundarys.js"></script>
    <script type="text/javascript" src="script/typenames.js"></script>
    <script type="text/javascript" src="script/route.js"></script>
    <script type="text/javascript" src="script/search.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.10.2.js"></script>

    <!-- <div class=header>

    </header> -->

    <div class="body">

    </div>
    <div class="map_wrap">

        <!-- <div id="map"></div> -->
        <div id="map" style="width:100%;height:100px;position:relative;overflow:hidden;"></div>

        <!-- ì§€ë„íƒ€ì… ì»¨íŠ¸ë¡¤ div ì…ë‹ˆë‹¤ -->
        <div class="custom_typecontrol radius_border">
            <span id="btnRoadmap" class="selected_btn" onclick="setMapType('roadmap')">ì§€ë„</span>
            <span id="btnSkyview" class="btn" onclick="setMapType('skyview')">ìŠ¤ì¹´ì´ë·°</span>
        </div>

        <!-- í˜„ìœ„ì¹˜ì´ë™ div ì…ë‹ˆë‹¤ -->
        <div class="custom_typecontrol radius_border"
            style="position:absolute;top:120px;right:10px;overflow:hidden;width:30px;height:30px;margin:0;z-index:1;border:1">
            <span id="btnTarget" class="btn" onclick="moveToCurrent()"
                style="display:flex;width:30px;height:30px;justify-content:center;align-items:center;"><img id="target"
                    src="images/icons/icon-target-7506947-30x30.png" width="20" height="20"></span>
        </div>

        <!-- ê²½ë¡œ ë§¤ì¹­ div ì…ë‹ˆë‹¤ -->
        <div class="custom_typecontrol radius_border"
            style="position:absolute;top:160px;right:10px;overflow:hidden;width:30px;height:30px;margin:0;z-index:1;border:1">
            <span id="btnMatch" class="btn" onclick="matchToRoute()"
                style="display:flex;width:30px;height:30px;justify-content:center;align-items:center;"><img id="iconMatch"
                    src="images/icons/resize_50_icon-walk-001.png" width="20" height="20"></span>
        </div>

        <!-- ì§€ë„ìƒ í˜„ìœ„ì¹˜ -->
        <div id="pulseMarker">
            <div class="pulse"></div>
        </div>

        <!-- ì§€ë„ìƒ ì¶œ/ë„ì°©ì§€ ì„¤ì • -->
        <div id="popupMarker" class="popup" style="position:absolute; z-index:999;display:none">
            <button class="route-btn depart">ğŸš© ì¶œë°œ</button>
            <button class="route-btn arrive">ğŸ ë„ì°©</button>
        </div>

        
        <!-- ì¢Œì¸¡ ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div id="left_control" style="position:absolute; top:0; left: 0;width: 400px;">
            <!-- ê²½ë¡œíƒìƒ‰ ì»¨íŠ¸ë¡¤ div ì…ë‹ˆë‹¤ -->
            <div class="custom_typecontrol radius_border"
                style="position:relative;top:10px;left:10px;overflow:hidden;width:250px;height:30px;margin:0;z-index:1;border:1">
                <span id="btnStart" class="btn blue" onclick="setRouteType(ClickTypeDeparture)"
                    style="width:50px">ì¶œë°œ</span>
                <span id="btnVia1" class="btn" onclick="setRouteType(ClickTypeWaypoint1)" style="width:30px">ê²½ìœ 1</span>
                <span id="btnVia2" class="btn" onclick="setRouteType(ClickTypeWaypoint2)" style="width:30px">ê²½ìœ 2</span>
                <span id="btnVia3" class="btn" onclick="setRouteType(ClickTypeWaypoint3)" style="width:30px">ê²½ìœ 3</span>
                <span id="btnVia4" class="btn" onclick="setRouteType(ClickTypeWaypoint4)" style="width:30px">ê²½ìœ 4</span>
                <span id="btnVia5" class="btn" onclick="setRouteType(ClickTypeWaypoint5)" style="width:30px">ê²½ìœ 5</span>
                <span id="btnEnd" class="btn red" onclick="setRouteType(ClickTypeDestination)"
                    style="width:50px">ë„ì°©</span>
            </div>

            <!-- ê²½ë¡œíƒìƒ‰ ìš”ì²­ div ì…ë‹ˆë‹¤ -->
            <div class="custom_typecontrol radius_border"
                style="position:absolute;left:260px;overflow:hidden;width:50px;height:30px;margin:0;z-index:1;border:1">
                <span id="btnRoute" class="btn" onclick="doRoute()" style="width:50px">íƒìƒ‰</span>
            </div>

            <!-- ê²½ë¡œíƒìƒ‰ JSON ìš”ì²­ div ì…ë‹ˆë‹¤ -->
            <div class="custom_typecontrol radius_border desktop-only"
                style="position:absolute;left:330px;overflow:hidden;width:70;height:30px;margin:0;z-index:1;border:0">
                <span id="btnGoToJsonResult" class="btn" onclick="gotoJSON()" style="width:65px">JSONë³´ê¸°</span>
            </div>

            <!-- ê²½ë¡œ ì˜µì…˜ div -->
            <div
                style="position:relative;margin-top:10px;left:10px;width:250px;padding:5px;background:rgba(255, 255, 255, 0.8);z-index: 1;font-size:11px;border-radius: 5px;">
                <input id="optShotest" onclick="setOption(0)" type="radio" name="option" style="margin-left: 5px;" />ì§§ì€ê¸¸
                <input id="optRecommended" onclick="setOption(1)" type="radio" name="option" checked
                    style="margin-left: 5px;" />ì¶”ì²œê¸¸
                <input id="optComfortable" onclick="setOption(2)" type="radio" name="option"
                    style="margin-left: 15px" />í¸í•œê¸¸
                <!-- <input id="optFastest" onclick="setOption(3)" type="radio" name="option" style="margin-left: 15px"/>ë¹ ë¥¸ê¸¸ -->
                <input id="optMainroad" onclick="setOption(4)" type="radio" name="option" style="margin-left: 15px" />í°ê¸¸
            </div>

            <!-- ì´ë™ì²´ íƒ€ì… div -->
            <div id="mobility_type"
                style="position:relative;left:10px;width:250px;padding:5px;background:rgba(255, 255, 255, 0.8);z-index: 1;font-size:11px;border-radius: 5px;">
                <span><img src="images/icons/resize_50_icon-pedestrian-002.png" height="20px" /><input id="mobWalk"
                        onclick="setMobility(0)" type="radio" name="mobility" checked
                        style="margin-left: 5px;" />ê±·ê¸°</span>
                <span style="margin-left: 20px"><img src="images/icons/resize_50_icon-bicycle-010.png"
                        height="20px" /><input id="mobBicycle" onclick="setMobility(1)" type="radio" name="mobility"
                        style="margin-left: 5px" />ìì „ê±°</span>
            </div>

            <!-- TAB div -->
            <div id="tabWrapper" style="position:fixed;top:110px;left:0;width:310px;margin-left:10px; height:auto;z-index:10;display:flex;">
                <div class="tab" style="position:relative;left:10px;margin-top: 5px; width:270px;height:auto;">
                    <ul class="tabnav" style="width:230px;margin:0;padding:0;border:0">
                        <li><a href="#tab_search" onclick="openTab('tab_search')">ê²€ìƒ‰</a></li>
                        <li><a href="#tab_coord" onclick="openTab('tab_coord')">ì´ë™</a></li>
                    </ul>
                    <div class="tabcontent" style="height:auto;border:0">
                        <!-- ê²€ìƒ‰ div -->
                        <div id="tab_search">
                            <div
                                style="padding:10px 5px;background:rgba(255, 255, 255, 0.8);z-index: 1;font-size:13px;border-radius:5px 5px 0 0;">
                                <form onsubmit="searchKeyword(); return false;">
                                    í‚¤ì›Œë“œ : <input type="text" value="ì•„ì´ë‚˜ë¹„ì‹œìŠ¤í…œì¦ˆ" id="keyword" style="width:160px;">
                                    <button type="submit">ê²€ìƒ‰</button>
                                </form>
                            </div>
                
                            <!-- ë©”ë‰´ ìƒì„± -->
                            <div id="menu_wrap" class="bg_white"
                                style="position:inherit;margin:0;width:auto;max-height:calc(100vh - 220px); border-radius:0 0 5px 5px;">
                                <div id="menu_title" style="text-align:center">
                                    <P>ê²€ìƒ‰ ê²°ê³¼</P>
                                </div>
                                <hr>
                                <div style="font-size:12px;font-family:'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;">
                                    <span id="searched_type" style="text-align:left">ê²°ê³¼ ê°¯ìˆ˜ : </span>
                                    <span id="searched_count" style="text-align:left"></span>
                                </div>
                                <hr>
                                <ul id="placesList"></ul>
                            </div>
                        </div>
                
                        <!-- ì´ë™ div -->
                        <div id="tab_coord"
                            style="padding:10px 5px;background:rgba(255, 255, 255, 0.8);z-index: 1;font-size:13px;border-radius: 5px;display: none;">
                            <form onsubmit="movotoPosition(); return false;">
                                ì¢Œí‘œ : <input type="text" value="127.110767364419,37.402186130724" id="coordinate" style="width:170px">
                                <button type="submit">ì´ë™</button>
                            </form>
                        </div>
                    </div>
                </div><!--tab-->
                <!-- íƒ­ ë³´ì´ê¸°/ê°ì¶”ê¸° ë²„íŠ¼ -->
                <div id="tabToggleHandle" style="position:relative;margin-left:10px;width:30px;cursor:pointer;display:flex;align-items:center;justify-content:center;user-select:none;
                        background: transparent;font-weight:bold;">
                    <span id="toggleIcon" style="font-size:15px;color:#666;">â—€</span>
                </div>
            </div> <!-- TAB div -->
        </div>
    </div>

    <script>
        let result_obj = JSON.parse('<%- JSON.stringify(result) %>');
        let cnt_route = 0;

        user_obj = result_obj.user_info;
        let result_mode = user_obj.mode;
        route_option = user_obj.option;
        if (result_mode === "pedestrian") {
            route_mode = RouteMode_Pedestrian;
            document.title = "ë³´í–‰/ìì „ê±° ê²½ë¡œíƒìƒ‰";
            document.getElementById("mobility_type").style.display="block";
        } else {
            document.getElementById("mobility_type").style.display="none";
        }

        let isSuccess = result_obj.header.isSuccessful;
        if (isSuccess) {
            cnt_route = result_obj.routes.length;
            user_pos = [result_obj.routes[0].vertex_info[~~((result_obj.routes[0].vertex_info.length) / 2)].x, result_obj.routes[0].vertex_info[~~((result_obj.routes[0].vertex_info.length) / 2)].y];
        } else {
            user_pos = [127.110767364419, 37.402186130724];// ì•„ì´ë‚˜ë¹„ì‹œìŠ¤í…œì¦ˆ
        }

        // map ì‚¬ì´ì¦ˆ ì¡°ì ˆ
        var screenHeight = window.innerHeight - 18;
        document.getElementById("map").style.height = screenHeight + "px";


        function initMap() {

            map = new inavi.maps.Map({
                center: user_pos,
                container: "map",
                zoom: 17
            });

            initMapObject(map);
            initDisplay();


            // ëŒ€êµ¬ í…Œí¬ë…¸í´ë¦¬ìŠ¤ ë„ë¡œë§í¬ ìœ íš¨ ë²”ìœ„
            // var boundarys = new inavi.maps.Polyline({
            //     map: map,
            //     path: getDaeguBoundary(),
            //     style: {
            //         lineColor: "#808080",
            //         lineWidth: 3,
            //         lineDasharray: [1, 1],
            //     },
            // });

            // ì„œìš¸ ë²”ìœ„
            // var boundarys = new inavi.maps.Polyline({
            //     map: map,
            //     path: getBukhansanBoundary(),
            //     style: {
            //         lineColor: "#808080",
            //         lineWidth: 3,
            //         lineDasharray: [1, 1],
            //     },
            // });

            // onmouseover

            // outmouseover




            //-- ë…¸ë“œ ìƒì„±

            if (isSuccess) {
                // ê²½ë¡œ ê·¸ë¦¬ê¸°
                drawRoutes(result_obj.routes, map, route_offset, route_color);

                // ì¶œë°œì§€
                setDeparture(new inavi.maps.LngLat(user_obj.start.x, user_obj.start.y));
                // ëª©ì ì§€
                setDestination(new inavi.maps.LngLat(user_obj.end.x, user_obj.end.y));
                // ê²½ìœ ì§€
                if (user_obj.vias != undefined) {
                    for (var ii = 0; ii < user_obj.vias.length; ii++) {
                        if (user_obj.vias[ii].x != 0 && user_obj.vias[ii].y != 0) {
                            setWaypoints(ii, new inavi.maps.LngLat(user_obj.vias[ii].x, user_obj.vias[ii].y));
                        }
                    }
                }

                // ê²½ë¡œ ì •ë³´ë¥¼ ì»¤ìŠ¤í…€ ì˜¤ë²„ë ˆì´ë¡œ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤
                drawRouteInfo(result_obj.routes);
            }
            else {
                alert('ê²½ë¡œ íƒìƒ‰ ìš”ì²­ ì‹¤íŒ¨')
            }
            //-- ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤

        } // initMap


        // í‚¤ì›Œë“œ ê²€ìƒ‰ 
        function searchKeyword() {
            var keyword = document.getElementById('keyword').value;

            if (!keyword.replace(/^\s+|\s+$/g, '')) {
                alert('í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return false;
            }
            console.log("request, search keyword: " + keyword)

            // var pathname = 'https://api-maps.cloud.toast.com/maps/v3.0/appkeys/uuLPV7fHLk6NIVfCPnBv/searches';
            var pathname = 'https://dev-maps.inavi.com/maps/v3.0/appkeys/<%=javascriptkey%>/searches'
            // var search2url = pathname + '?&query=' + keyword.toString() + '&reqcount=' + 10;

            getSearch(pathname, keyword);
        }


        // TAB ì»¨í…ì¸ 
        $(function () {
            $('.tabcontent > div').hide();
            $('.tabnav a').click(function () {
                $('.tabcontent > div').hide().filter(this.hash).fadeIn();
                $('.tabnav a').removeClass('active');
                $(this).addClass('active');
                return false;
            }).filter(':eq(0)').click();
        });

    </script>

    <script type="text/javascript"
        src="https://dev-maps.inavi.com/maps/v3.0/appkeys/<%=javascriptkey%>/maps?callback=initMap"></script>
    <!-- <script src="/script/position.js"></script> -->

    <script type="text/javascript" src="script/display.js"></script>
</body>

</html>